<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Photo Album</title>
  <style>
    html, body { height:100%; margin:0; background:#000; }
    #wrap { height:100%; display:flex; align-items:center; justify-content:center; }
    #viewer {
      max-width: 100vw;
      max-height: 100vh;
      object-fit: contain;
      transition: opacity 220ms ease;
      opacity: 1;
      user-select:none;
      -webkit-user-drag:none;
    }
  </style>
</head>
<body>
  <div id="wrap">
    <img id="viewer" alt="album" />
  </div>

  <script>
    const images = [
      "images/표지(1080x1350)_C 1.png",
      "images/목차 2.png",
      "images/간지 1.png",
    ];

    const INTERVAL_MS = 3000;

    const viewer = document.getElementById("viewer");
    let idx = 0;
    let timer = null;
    let isPlaying = true;

    function preload(i) {
      if (!images.length) return;
      const safe = (i + images.length) % images.length;
      const img = new Image();
      img.src = images[safe];
    }

    function show(i) {
      if (!images.length) return;
      idx = (i + images.length) % images.length;

      // 페이드 아웃 -> src 변경 -> 로드 후 페이드 인
      viewer.style.opacity = 0;

      const nextSrc = images[idx];
      const tmp = new Image();
      tmp.onload = () => {
        viewer.src = nextSrc;
        viewer.style.opacity = 1;

        // 주변 프리로드(체감 품질 핵심)
        preload(idx + 1);
        preload(idx - 1);
      };
      tmp.src = nextSrc;
    }

    function scheduleNext() {
      clearTimeout(timer);
      if (!isPlaying) return;
      timer = setTimeout(() => {
        next(false);
      }, INTERVAL_MS);
    }

    function next(fromUser = true) {
      show(idx + 1);
      // 사용자 액션이면 즉시 넘기고 타이머 리셋
      scheduleNext();
    }

    function prev() {
      show(idx - 1);
      scheduleNext();
    }

    // 클릭하면 다음 장
    document.addEventListener("click", () => next(true));

    // 키보드 지원
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") next(true);
      if (e.key === "ArrowLeft") prev();
      if (e.key === " ") { // 재생/일시정지
        e.preventDefault();
        isPlaying = !isPlaying;
        scheduleNext();
      }
    });

    // 모바일 스와이프(아주 간단)
    let startX = null;
    document.addEventListener("touchstart", (e) => {
      startX = e.touches[0].clientX;
    }, { passive: true });
    document.addEventListener("touchend", (e) => {
      if (startX == null) return;
      const endX = e.changedTouches[0].clientX;
      const dx = endX - startX;
      startX = null;
      if (Math.abs(dx) < 40) return;
      if (dx < 0) next(true); else prev();
    }, { passive: true });

    // 시작
    show(0);
    scheduleNext();
  </script>
</body>
</html>