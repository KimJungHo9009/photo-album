<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Photo Album</title>
  <style>
    html, body { height:100%; margin:0; background:#000; }
    #wrap { height:100%; display:flex; align-items:center; justify-content:center; }
    #viewer {
      max-width: 100vw;
      max-height: 100vh;
      object-fit: contain;
      transition: opacity 220ms ease;
      opacity: 1;
      user-select:none;
      -webkit-user-drag:none;
    }
  </style>
</head>
<body>
  <div id="wrap">
    <img id="viewer" alt="album" />
  </div>

  <script>
    const images = [
      "images/표지(1080x1350)_C 1.png",
      "images/목차 2.png",
      "images/간지 1.png",
    ];

    const INTERVAL_MS = 3000;

    const viewer = document.getElementById("viewer");
    let idx = 0;
    let timer = null;
    let isPlaying = true;
    let isLocked = false; // ✅ 마지막에서 완전 잠금

    function atLast() {
      return idx >= images.length - 1;
    }

    function preload(i) {
      if (!images.length) return;
      const safe = Math.max(0, Math.min(i, images.length - 1)); // ✅ 범위 고정
      const img = new Image();
      img.src = images[safe];
    }

    function show(i) {
      if (!images.length) return;
      idx = Math.max(0, Math.min(i, images.length - 1)); // ✅ 마지막에서 멈춤 (루프 없음)

      viewer.style.opacity = 0;

      const nextSrc = images[idx];
      const tmp = new Image();
      tmp.onload = () => {
        viewer.src = nextSrc;
        viewer.style.opacity = 1;

        preload(idx + 1);
        preload(idx - 1);

        // ✅ 마지막 이미지면: 자동 넘김 중단 + 입력 잠금
        if (atLast()) {
          lockAtEnd();
        }
      };
      tmp.src = nextSrc;
    }

    function lockAtEnd() {
      isLocked = true;
      isPlaying = false;
      clearTimeout(timer);
    }

    function scheduleNext() {
      clearTimeout(timer);
      if (!isPlaying || isLocked) return;
      timer = setTimeout(() => next(false), INTERVAL_MS);
    }

    function next(fromUser = true) {
      if (isLocked) return;
      if (atLast()) {
        lockAtEnd();   // ✅ 혹시나 호출돼도 잠금
        return;
      }
      show(idx + 1);
      scheduleNext();
    }

    function prev() {
      // ✅ 요구사항: 마지막에서 사용자 액션도 동작하지 않게
      if (isLocked) return;
      show(idx - 1);
      scheduleNext();
    }

    // ✅ 사용자 이벤트: locked면 전부 무시
    document.addEventListener("click", () => {
      if (isLocked) return;
      next(true);
    });

    document.addEventListener("keydown", (e) => {
      if (isLocked) return;

      if (e.key === "ArrowRight") next(true);
      if (e.key === "ArrowLeft") prev();
      if (e.key === " ") {
        e.preventDefault();
        isPlaying = !isPlaying;
        scheduleNext();
      }
    });

    let startX = null;
    document.addEventListener("touchstart", (e) => {
      if (isLocked) return;
      startX = e.touches[0].clientX;
    }, { passive: true });

    document.addEventListener("touchend", (e) => {
      if (isLocked) return;
      if (startX == null) return;

      const endX = e.changedTouches[0].clientX;
      const dx = endX - startX;
      startX = null;

      if (Math.abs(dx) < 40) return;
      if (dx < 0) next(true);
      else prev();
    }, { passive: true });

    // 시작
    show(0);
    scheduleNext();
  </script>
</body>
</html>